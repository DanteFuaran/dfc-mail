# 📧 DFC Mail Bot

Telegram-бот для продажи цифровых товаров (почтовых аккаунтов) с автоматической выдачей после оплаты.

## 🚀 Быстрый старт

### ▶️ Полная установка одной командой

```bash
bash <(curl -s https://raw.githubusercontent.com/DanteFuaran/dfc-mail/main/install-wrapper.sh)
```

### 📝 Данные для настройки

Скрипт запросит следующие параметры:

> **Токен бота** — получите в [@BotFather](https://t.me/BotFather)
> **Username бота** — username без @
> **Telegram ID администратора** — ваш числовой ID (используйте [@userinfobot](https://t.me/userinfobot))
> **Контакт поддержки** — @username (опционально)
> **Платежные системы** — ЮКасса, Heleket (опционально)

⚠️ Пароли БД генерируются автоматически.

### 📦 Что сделает скрипт

> ✅ Проверит Docker и OpenSSL
> ✅ Создаст структуру каталогов `/opt/dfc-mail`
> ✅ Сгенерирует конфигурацию `.env`
> ✅ Развернет PostgreSQL
> ✅ Соберет и запустит бота в Docker
> ✅ Установит команду управления `dfc-mail`

После установки управление доступно через команду `dfc-mail`

---

<details>
<summary>

## $${\color{blue}✨\ Ключевые\ возможности}$$

</summary>

### 👤 Для пользователей
- 🛒 Каталог товаров с категориями
- 💰 Множество способов оплаты: баланс, ЮКасса, Heleket, Telegram Stars
- 📦 Автоматическая выдача товаров после оплаты
- 💳 Система баланса с пополнением
- 👥 Реферальная программа (10% комиссия)
- 🔔 Подписки на уведомления о поступлении товара
- 📋 История заказов

### ⚙️ Для администраторов
- 🎛️ Админ-панель для управления магазином
- 📊 Статистика по заказам и пользователям
- 📦 Управление каталогом: категории, товары, аккаунты
- 👥 Управление пользователями: блокировка, пополнение баланса
- 📢 Рассылка сообщений
- 📝 Логирование ошибок
- 🔔 Уведомления о покупках

### 🔒 Безопасность
- ✅ Транзакции БД (ACID)
- ✅ Бронирование товаров на 15 минут
- ✅ Ограничение неоплаченных заказов
- ✅ Суперпользователи через `.env`

</details>

<details>
<summary>

## $${\color{blue}📋\ Требования}$$

</summary>

- Linux (Ubuntu 20.04+, Debian 11+)
- Docker и Docker Compose
- OpenSSL
- 512 МБ RAM
- Токен бота от [@BotFather](https://t.me/BotFather)

</details>

<details>
<summary>

## $${\color{blue}🧰\ Панель\ управления}$$

</summary>

После установки выполните в терминале:

```bash
dfc-mail
```

Доступные действия:
- 🔄 Перезапуск / Запуск / Остановка
- 📋 Просмотр логов
- ✏️ Редактирование `.env`
- 🔄 Обновление бота
- 🔁 Переустановка
- 🗑 Удаление

</details>

<details>
<summary>

## $${\color{blue}📁\ Структура\ проекта}$$

</summary>

```
dfc-mail/
├── src/
│   ├── main.py                    # Точка входа
│   ├── config.py                  # Конфигурация
│   ├── __init__.py
│   ├── database/
│   │   ├── database.py            # Подключение к БД
│   │   └── models.py             # Модели
│   ├── bot/
│   │   ├── handlers/
│   │   │   ├── start.py          # /start
│   │   │   ├── catalog.py        # Каталог
│   │   │   ├── orders.py         # Заказы
│   │   │   ├── balance.py        # Баланс
│   │   │   ├── payment.py        # Платежи
│   │   │   ├── referral.py       # Реферальная система
│   │   │   ├── info.py           # Информация / Поддержка
│   │   │   ├── admin.py          # Админ-панель
│   │   │   ├── broadcast.py      # Рассылка
│   │   │   └── webhook.py        # Webhook обработчики
│   │   ├── keyboards/
│   │   │   └── __init__.py       # Все клавиатуры
│   │   ├── middlewares/
│   │   │   ├── database.py       # БД middleware
│   │   │   ├── blocked_user.py   # Проверка блокировки
│   │   │   ├── error_handler.py  # Обработка ошибок
│   │   │   └── keyboard_update.py
│   │   └── texts/
│   │       └── __init__.py       # Тексты сообщений
│   ├── services/
│   │   ├── payment.py            # Платежные системы
│   │   ├── account_service.py    # Выдача аккаунтов
│   │   ├── discount.py           # Скидки
│   │   ├── notifications.py      # Уведомления
│   │   └── promotions.py         # Промоакции
│   └── utils/
│       └── logger.py             # Логирование
├── scripts/
│   ├── docker-entrypoint.sh
│   └── backup_db.py
├── Dockerfile
├── docker-compose.yml
├── install.sh
├── install-wrapper.sh
├── requirements.txt
├── .env.example
└── version
```

</details>

<details>
<summary>

## $${\color{red}🔧\ Частые\ ошибки}$$

</summary>

### Бот не запускается
1. Проверьте токен: `dfc-mail` → Логи
2. Убедитесь что Docker запущен: `docker ps`
3. Проверьте `.env`: `dfc-mail` → Редактировать .env

### Платежи не работают
1. Проверьте ключи в `.env`
2. Настройте webhook для платежных систем
3. Проверьте логи

### Ошибка базы данных
1. Перезапустите: `dfc-mail` → Перезапуск
2. Если не помогает — переустановите: `dfc-mail` → Переустановка

</details>

## 📜 Лицензия

Проприетарное ПО. Все права защищены.

---

⭐ Поставьте звезду, если проект оказался полезным!
